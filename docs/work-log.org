#+TITLE: Emacs Configuration Work Log
#+STARTUP: showall

* 2026-01-27: Keybinding documentation system & keys.el cleanup
- Resolved 6 issues in [[file+emacs:/Users/jay/emacs/emacs-settings/keys.el][keys.el]]:
  1. Removed duplicate help bindings
  2. Fixed ~s->~ conflict (kept =load-gnu-startup=, removed =org-mark-subtree=)
  3. Fixed ~C-s-k~ conflict (kept =org-cut-subtree=)
  4. Fixed ~C-S-return~ duplicate in org mode-local block
  5. Replaced all lambda bindings with named wrapper functions (=my/org-show-level-N=, =my/org-agenda-day=, =my/panic-save-and-quit=, =my/scroll-up=, =my/scroll-down=)
  6. Redistributed "Migrated Bindings" grab-bag into thematic sections and deleted the catch-all section
- Refactored Section 5 (mode-local bindings) from procedural ~define-key~ calls into declarative alists with ~my/mode-binding-registry~ for introspection
- Created [[file+emacs:/Users/jay/emacs/emacs-settings/keybinding-docs.el][keybinding-docs.el]] with:
  - =keyfreq= integration for silent usage tracking
  - =M-x my/keybinding-dump= — auto-generates [[file+emacs:/Users/jay/emacs/emacs-settings/docs/keybinding-dump.org][keybinding-dump.org]] from declarative alists
  - =M-x my/keybinding-merge= — merges dump with [[file+emacs:/Users/jay/emacs/emacs-settings/docs/keybinding-annotations.org][keybinding-annotations.org]] to produce [[file+emacs:/Users/jay/emacs/emacs-settings/docs/keybinding-reference.org][keybinding-reference.org]], flags =[NEW]= and =[REMOVED]= bindings
  - =M-x my/keybinding-frequency-report= — generates [[file+emacs:/Users/jay/emacs/emacs-settings/docs/keybinding-frequency-report.org][keybinding-frequency-report.org]] with most-used commands, ergonomic mismatches, and underused prime keys
- Added =keyfreq= to =dotspacemacs-additional-packages= in [[file+emacs:/Users/jay/emacs/emacs-settings/spacemacs.d/init.el][init.el]]
- Added load call for [[file+emacs:/Users/jay/emacs/emacs-settings/keybinding-docs.el][keybinding-docs.el]] in [[file+emacs:/Users/jay/emacs/emacs-settings/spacemacs.d/init.el][init.el]] user-config
- Created [[file+emacs:/Users/jay/emacs/emacs-settings/docs/keybinding-annotations.org][keybinding-annotations.org]] skeleton with initial annotations
- Updated [[file+emacs:/Users/jay/emacs/emacs-settings/docs/macOS-command-key-bindings.org][macOS-command-key-bindings.org]]: converted tables to description lists, fixed stale entries (=s->= now =load-gnu-startup=, =s-k a d= now =my/org-agenda-day=), added cross-reference to keybinding-reference.org

* 2026-01-27: Plan keybinding consolidation into keys.el
- Created [[file+emacs:/Users/jay/emacs/emacs-settings/docs/keybinding-consolidation-plan.org][keybinding-consolidation-plan.org]] with full migration plan
- Goal: move all ~define-key~, ~global-set-key~, ~define-super-key~, and ~spacemacs/set-leader-keys~ calls into [[file+emacs:/Users/jay/emacs/emacs-settings/keys.el][keys.el]] as the single canonical keybinding location
- Scope: ~670+ bindings across 7 source files (gnu-emacs-startup.org, shared-functions.org, search-commands.org, spacemacs-new-config.el, org-roam-config.el, spacecraft-mode.org, jay-org-roam-core.el)
- [[file+emacs:/Users/jay/emacs/emacs-settings/jay-osx.el][jay-osx.el]] preserved as-is
- Identified ~C-c d~ conflict: ~crux-duplicate-current-line-or-region~ vs ~insert-todays-date~
- Updated [[file+emacs:/Users/jay/emacs/emacs-settings/docs/instructions.org][instructions.org]]: added org-mode links to all file references, updated Changing Keybindings section
- In-progress migrations already completed:
  - Moved bindings from [[file+emacs:/Users/jay/emacs/emacs-settings/search-commands.org][search-commands.org]], [[file+emacs:/Users/jay/emacs/emacs-settings/spacemacs-new-config.el][spacemacs-new-config.el]], [[file+emacs:/Users/jay/emacs/emacs-settings/goals-agenda.el][goals-agenda.el]], and [[file+emacs:/Users/jay/emacs/emacs-settings/spacecraft-mode.org][spacecraft-mode.org]] into [[file+emacs:/Users/jay/emacs/emacs-settings/keys.el][keys.el]]
  - Smart punctuation org-mode bindings (~smart-space~, ~smart-period~, ~comma-or-smart-comma~, ~smart-question-mark~, ~smart-exclamation-point~, ~smart-hyphen~, ~smart-semicolon~, ~colon-or-smart-colon~) moved into ~with-eval-after-load 'org~ block in keys.el
  - Case-change bindings (~M-C~ → ~capitalize-word~, ~M-L~ → ~downcase-sentence~) moved into ~my/global-key-bindings~ alist
- Continued migration into [[file+emacs:/Users/jay/emacs/emacs-settings/keys.el][keys.el]]:
  - Moved remaining shared-functions bindings (org backtick correction, palimpsest ~C-c C-r~, org-src ~C-c C-c~, Info/winner/ctrlf/markdown maps, minibuffer ~C-g~, multiple-cursors prefix map, panic button ~C-c C-!~, and ~C-x m~)
  - Moved ~C-c <mouse-3>~ right-click context menu binding into global map bindings
- Updated [[file+emacs:/Users/jay/emacs/emacs-settings/docs/macOS-command-key-bindings.org][macOS-command-key-bindings.org]] by regenerating s- / s-/ / s-k tables from [[file+emacs:/Users/jay/emacs/emacs-settings/keys.el][keys.el]]
- Generated [[file+emacs:/Users/jay/emacs/emacs-settings/docs/keybindings-master.org][keybindings-master.org]] as a full custom keybinding catalog from [[file+emacs:/Users/jay/emacs/emacs-settings/keys.el][keys.el]]
- Cleaned broken binding stubs in [[file+emacs:/Users/jay/emacs/emacs-settings/shared-functions.org][shared-functions.org]] and [[file+emacs:/Users/jay/emacs/emacs-settings/gnu-emacs-startup.org][gnu-emacs-startup.org]] created by earlier removals
- Retangled [[file+emacs:/Users/jay/emacs/emacs-settings/shared-functions.org][shared-functions.org]] and [[file+emacs:/Users/jay/emacs/emacs-settings/gnu-emacs-startup.org][gnu-emacs-startup.org]] and reran ~check-parens~ on both generated .el files

* 2026-01-15: Corrective note on commit instruction misunderstanding
- Added a corrective note acknowledging a mistaken response about committing all changes when asked

* 2026-01-15: Move search/completion stack into search-commands.org
- Moved isearch, ivy/swiper, consult, orderless/vertico/embark, counsel, and related helpers out of =shared-functions.org=
- Consolidated search utilities (rg/deadgrep, consult-locate, counsel-fd, consult ripgrep advice, org heading search) into =search-commands.org=
- Removed redundant mini vertico stanza from projectile section after the move

* 2026-01-15: Document optional shared-functions.org split candidates
- Noted low-coupling extraction options in =docs/design-architecture.org=:
  keybindings/key-chord, search/completion, org-roam stubs, UI/appearance, and web-research helpers

* 2025-12-31: Make org-emphasis-regexp-components survive resets
- Previous fix (2025-12-26) only applied settings once at org load time
- Problem: Spacemacs functions like ~spacemacs/prettify-org-buffer~ and ~space-doc-mode~ were resetting the emphasis regex
- Solution in ~spacemacs-new-config.el~:
  1. Store settings in ~jay/org-emphasis-regexp-components~ defvar
  2. Create ~jay/apply-org-emphasis-settings~ function to reapply
  3. Hook into ~org-mode-hook~ to reapply on every org buffer
  4. Add ~:after~ advice on ~spacemacs/prettify-org-buffer~ and ~spacemacs//space-doc-alternative-emphasis~
- Now emphasis settings survive org reloads, new buffers, and Spacemacs overrides

* 2025-12-31: Update recovery-guide.org for GUI Emacs
- All commands now use explicit ~/Applications/Emacs.app/Contents/MacOS/Emacs~ path
- Added recovery aliases to ~jay-scripts.sh~: ~emacs-debug~, ~emacs-vanilla~, ~emacs-check~
- Restructured guide with clear "When to Use" intro and "Try this if" context for each step
- Quick reference table now shows when to use each step, not just what to do
- Moved technical details to appendices (batch syntax check, error patterns, prevention)

* 2025-12-31: Sync recovery docs and source-of-truth references
- Updated Spacemacs path references to =/Users/jay/emacs/emacs-settings/spacemacs.d/init.el= and =~/.spacemacs.d= symlink guidance
- Switched pasteboard documentation to the pure elisp source (=pasteboard-copy-and-paste-functions.el=) and removed stale .org references
- Fixed diary file path to =/Users/jay/Dropbox/github/timeless/data/timeline.md= in calendar docs
- Resolved duplicate =s->= binding in =docs/macOS-command-key-bindings.org= (kept =load-gnu-startup=)
- Added =docs/recovery-recommendations-codex.org= with recovery audit and recommended improvements

* 2025-12-31: Implement known-good fallback (manual)
- Tagged current config as =known-good= and created worktree at =~/emacs/emacs-settings-known-good=
- Aligned =docs/recovery-guide.org= to use the long-form recovery aliases (=emacs-debug=, =emacs-vanilla=, =emacs-min=, =emacs-known-good=)

* 2025-12-31: Create recovery guide and minimal init
- Created ~docs/recovery-guide.org~ with 5-level escalation path for when Emacs won't start
- Created ~minimal-init.el~ escape hatch for bypassing Spacemacs entirely
  - Usage: ~emacs -Q -l ~/emacs/emacs-settings/minimal-init.el~
  - Provides basic org-mode, macOS keybindings, dark theme
  - No packages, no complexity - emergency editing only

* 2025-12-31: Backup system audit
- Audited backup system and found critical issues:
  - 1,906 unpushed commits to GitHub (fixed with this push)
  - Documentation claimed Dropbox sync but emacs-settings not in Dropbox
  - ~backup-system.org~ said ~kept-new-versions 50~ but actual config has ~9~
  - Recovery scripts mentioned in docs don't exist
  - ~spacemacs.after-incident-20251005~ still exists (should be deleted)
- Verified working backup layers:
  - Per-save backups: 9,132 files, 185MB in ~~/emacs/backup/per-save/~
  - Per-session backups: 2,895 files, 76MB in ~~/.emacs.d/backup/per-session/~
  - Time Machine configured to "Remnant"

* 2025-12-31: Major documentation consolidation
- Reduced docs/ from 14+ files to 11 by eliminating redundancy
- Merged files:
  - ~suggested-next-steps.org~ into ~critical-next-steps.org~ (combined roadmap)
  - ~the-emacs-settings-approach.org~ into ~design-architecture.org~ (added philosophy section)
  - ~visual-design-philosophy.org~ into ~instructions.org~ (added visual design section)
  - ~pasteboard-markdown-detection.org~ into ~pasteboard-architecture.org~
- Deleted redundant files:
  - ~ORG-ROAM-PROFILES-QUICKSTART.org~ (README.md sufficient)
  - ~CHANGE-LOG.org~ (redundant with work-log.org)
- Extracted key lessons and deleted:
  - ~spacemacs-incident-20251005.org~ → symlink safety lesson added to ~codebase-wisdom.org~
  - ~info-calendar-debug.org~ → info build-from-source lesson added to ~codebase-wisdom.org~
- Remaining core docs: instructions, design-architecture, codebase-wisdom, critical-next-steps, backup-system, pasteboard-architecture, work-log

* 2025-12-31: Refactor shared-functions.org and archive unused code
- Refactored `org-show-level-X` functions in `shared-functions.org`:
  - Replaced repetitive definitions for levels 1-8 with a single `org-show-level` function taking an argument.
  - Updated keybindings to use lambda functions calling `org-show-level`.
- Archived unused code:
  - Moved unused `my-org-export-change-options` examples to new file `shared-functions-archive.org`.
- Verified `chatgpt2org` alias points to existing `elpa-supplement/chatgpt2org.el`.
- Replaced hardcoded `~/Dropbox` paths with `jay/dropbox-dir` variable for portability.
- Optimized `buffer-stack-filter-regexp` using `regexp-opt` for better readability and performance.

* 2025-12-26: Fix org-emphasis-regexp-components not taking effect
- Fixed org emphasis (bold, italic) not being fontified in some buffers
- Root cause: Setting ~org-emphasis-regexp-components~ alone doesn't rebuild the cached regex
- Added explicit call to ~org-set-emph-re~ after org loads in ~spacemacs-new-config.el~:
  #+begin_src elisp
  (setq org-emphasis-regexp-components
        '("-[:space:]('\"{" "-[:space:].,:!?;'\")}\\[" "[:space:]" "." 1))
  (with-eval-after-load 'org
    (org-set-emph-re 'org-emphasis-regexp-components org-emphasis-regexp-components))
  #+end_src
- Key insight: Org caches the compiled emphasis regex; you must call ~org-set-emph-re~ to rebuild it after changing components

* 2025-12-20: Fix pasteboard-paste-clean stripping double line breaks
- Fixed ~pasteboard--strip-trailing-whitespace~ in ~pasteboard-copy-and-paste-functions.el~
- Changed regex from ~[[:space:]]+$~ to ~[ \t]+$~
- The ~[[:space:]]~ character class in Emacs includes newlines, causing blank lines to be stripped
- The fix uses ~[ \t]~ to match only horizontal whitespace (spaces and tabs), preserving paragraph breaks

* 2025-12-17: Rename functions for clarity and add new-buffer-in-new-pane
- Added ~new-buffer-in-new-pane~ function: splits window left and creates new org buffer
- Updated ~clone-indirect-buffer-new-window-and-focus~ to narrow both panes to subtree
- Renamed ~remove-links/jay~ → ~remove-hyperlink-at-point~
- Renamed 8 functions to use descriptive names instead of author prefixes:
  - ~dcaps-to-scaps~ → ~fix-double-capitals~
  - ~ap/org-count-words~ → ~org-count-words-in-subtree~
  - ~ndk/checkbox-list-complete~ → ~org-checkbox-list-complete~
  - ~endless/replace-apostrophe~ → ~replace-curly-apostrophe~
  - ~endless/replace-quote~ → ~replace-curly-quotes~
  - ~xah-convert-entities-to-html-chars-region~ → ~html-entities-to-chars~
  - ~xah-convert-html-chars-to-entities-region~ → ~html-chars-to-entities~
  - ~er-google~ → ~google-search-region~
- Updated keybindings:
  - ~M-t~ now bound to ~mw-thesaurus-lookup-dwim~
  - ~s-T~ now bound to ~new-buffer-in-new-pane~

* 2025-12-15: Guard native-comp settings for non-native-comp Emacs builds
- Fixed "Symbol's value as variable is void: native-comp-eln-load-path" error on startup
- Wrapped all native-comp settings in ~spacemacs.d/init.el~ with ~(when (boundp 'native-comp-eln-load-path) ...)~
- Settings guarded: ~native-comp-eln-load-path~, ~package-native-compile~, ~native-comp-jit-compilation~, ~native-comp-deferred-compilation~, ~native-comp-async-report-warnings-errors~
- Moved GC tuning (~gc-cons-threshold~, ~gc-cons-percentage~) outside the guard since those apply to all builds
- Current macOS Emacs cask build lacks native-comp support; these settings will auto-activate when switching to a native-comp build in the future

* 2025-12-11: Fix flyspell infinite recursion bug
- Fixed critical infinite recursion bug in ~flyspell-lazy-check-pending~ function in ~shared-functions.org~
  - Bug occurred when processing large files (200MB+) in fundamental mode
  - Added conditional return using ~(cl-return-from flyspell-lazy-check-pending nil)~
  - Only applies fix when idle timer is nil to avoid disrupting normal operations
  - Prevents Emacs from hanging with "Lisp nesting exceeds max-lisp-eval-depth" errors
- Updated keybindings in ~gnu-emacs-startup.org~:
  - Reverted ~s-K~ back to ~org-cut-subtree~ (was ~kill-region~)
  - Reverted ~s-M~ back to ~tr-toggle-transclusion~ (was ~capitalize-region-or-word~)
  - These changes better support org-transclusion workflow

* 2025-12-09: Org-transclusion documentation and social profile setup
- Created ~/docs/org-transclusion-guide.org~ with comprehensive documentation:
  - Quick reference for keybindings (~s-K~, ~S-s-<down>~, ~s-u t~)
  - Step-by-step walkthrough for transcluding headings between files
  - Commands reference for power-pack functions (~tr-toggle-transclusion~, etc.)
  - Troubleshooting section
- Updated ~roam-social~ profile in ~jay-org-roam-profiles.el~:
  - Changed directory from ~/Users/jay/Dropbox/roam-social~ to ~/Users/jay/Dropbox/social~
  - Points to existing social principles files instead of empty roam-social directory
- Added org-roam frontmatter (ID + title + filetags) to 8 files in ~/Users/jay/Dropbox/social~:
  - ~social-principles-streamlined.org~, ~conan-examples.org~, ~find-the-game.org~
  - ~gemini-how-to-improv.org~, ~advanced-principles.org~, ~in-person-principles.org~
  - ~index.org~, ~nyc-locations-master.org~
- Created ~/Users/jay/Dropbox/social/journal/~ directory for dailies
- Removed blue background shading from transcluded content in ~shared-functions.org~

* 2025-12-07: Update quote environment in elegant-garamond LaTeX template
- Styled quote environment to match ~beautiful-racket~ template:
  - Powder blue background (#f5f7ff), stormy blue-grey frame (#708090), moon rock grey text (#5D5D5D)
  - Centered block with left-aligned text
  - Breakable across pages
- Added paragraph spacing inside quotes using ~before upper={\setlength{\parskip}{1em}}~
- Set font to ~\footnotesize~ with ~\raggedright~ alignment
- Fixed deprecated ~org-latex-to-pdf-process~ → ~org-latex-pdf-process~ in ~beautiful-racket.el~
- Renamed original to ~beautiful-racket-classic.el~, promoted Tufte version to ~beautiful-racket.el~
- ~beautiful-racket.el~ now includes Tufte-style typography enhancements:
  - Letterspacing for small caps via ~letterspace~ package (~\textsc~, ~\smallcaps~, ~\allcaps~)
  - ~ragged2e~ package for better ragged right with hyphenation
  - ~textcase~ package for ~\MakeTextUppercase~/~\MakeTextLowercase~
  - Tufte-style font size definitions (10pt/14pt baseline)
  - Fixed ~\makeatletter~/~\makeatother~ wrapping for font redefinitions
  - Added ~\newthought~ command for Tufte-style paragraph openers
  - Commented out ~\textbf~ redefinition that was causing bold to render as italic

* 2025-12-06: Fix paths and display settings
- Updated ~goals-agenda.el~ to use CloudStorage paths (~~/Library/CloudStorage/Dropbox/~)
- Changed master task list path from ~data/~ to ~goals/~ subdirectory
- Added "DELL U3223QE" to ~jay/notch-display-identifiers~ for external monitor support

* 2025-12-06: Improve double-line-breaks-in-region function
- Rewrote ~double-line-breaks-in-region~ in ~shared-functions.org~ to fix several issues:
  - Now normalizes Windows (~\r\n~) and old Mac (~\r~) line endings first
  - Collapses 3+ consecutive newlines to exactly 2
  - Only doubles single newlines, leaving existing double breaks unchanged
  - Fixed boundary handling so newlines at region start/end are processed
- Added keybinding ~s-k d l~ in ~gnu-emacs-startup.org~

* 2025-12-01: Add invisible space handling to html2org-clipboard
- Added ~\u202F~ (narrow no-break space) replacement to ~chatgpt2org.el~
- Added ~\u200B~ (zero-width space) removal to ~chatgpt2org.el~
- These characters were causing issues when pasting from Instagram DMs
- Already handled in ~pasteboard-copy-and-paste-functions.el~ via ~smart-quotes-replacement-pairs~ and ~replace-weird-spaces~, but ~html2org-clipboard~ uses a separate code path via ~chatgpt2org~

* Archive
See [[file:work-log-2025.org][work-log-2025.org]] for earlier entries.
