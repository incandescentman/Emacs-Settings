#+TITLE: Operational Instructions
#+DATE: 2025-09-24
#+DESCRIPTION: How to install, use, and maintain the Emacs configuration.

* Installation and Setup
1. `git clone git@github.com:incandescentman/Emacs-Settings.git ~/emacs/emacs-settings`
2. Symlink `init.el` into your home directory as the Spacemacs entry point: `ln -s ~/emacs/emacs-settings/init.el ~/.spacemacs`
3. Launch Emacs; allow Spacemacs to download layers and packages (first boot can take several minutes).
4. Run `SPC f e R` (or `M-m f e R`) to reload the configuration after package install completes.
5. Optional: byte-compile the tangled `.el` files with `SPC f e c` or `(byte-recompile-directory "~/emacs/emacs-settings" 0)` for faster startup.

* Feature Overview
** Clipboard hygiene
- `s-v` (`pasteboard-paste-adaptive`) chooses the paste pipeline automatically—text buffers get the cleaner, code buffers call `pasteboard-paste-verbatim`.
- `s-c` (`pasteboard-copy-adaptive`) chooses the copy pipeline automatically—code buffers copy verbatim, text buffers clean em-dashes and formatting.
- `s-x` (`pasteboard-cut-adaptive`) chooses the cut pipeline automatically—uses same logic as copy, then deletes region and handles spacing/capitalization.
- `C-u s-v` forces verbatim paste, overriding smart detection (useful when you need exact whitespace/formatting in a text buffer).
- `C-u s-c` forces verbatim copy, overriding smart detection (useful when copying code snippets from text buffers).
- `C-u s-x` forces verbatim cut, overriding smart detection (useful when cutting code snippets from text buffers).
- Run `M-x pasteboard-paste-verbatim` (alias: `pasteboard-paste-raw`) to force a byte-for-byte paste in any buffer.
** Org-centric tooling
- Org Roam layer enabled; capture templates expect `org-roam` database.
- `pasteboard-paste-adjusted-subtrees` demotes headings when pasting into existing Org trees.
** Org-roam profiles (multi-database support)
- Switch between independent org-roam databases (work vs. personal)
- **Quick switches**:
  - `s-u 1` - Switch to default (work) profile
  - `s-u 2` - Switch to my-life (personal) profile
  - `s-u P` - Interactive profile switch with completion
  - `s-u C-p` - Show current profile info
- **Profiles**:
  - *default (Work)*: `~/Dropbox/roam/` with work templates (AI, job hunt, people, quotes, etc.)
  - *my-life (Personal)*: `~/Dropbox/roam-life/` with personal templates (journal, gratitude, health, family, etc.)
- **Mode-line indicator**: Shows `[Roam:Default]` or `[Roam:My]` (click to switch)
- **Persistence**: Last-used profile is remembered across sessions
- **Independence**: Each profile has its own database, directory, and capture templates - completely isolated
- **Astro exports**:
  - Profile switches retarget `org-astro-source-root-folder` automatically (`~/Library/CloudStorage/Dropbox/roam` for work, `~/Library/CloudStorage/Dropbox/roam-life` for personal)
  - One-off helpers `jay/org-astro-export-from-roam` and `jay/org-astro-export-from-roam-life` temporarily rebind the root and call `org-astro-export-to-mdx`
** Appearance controls
- Commands like `medium-type`, `large-type`, `spacemacs-light`, and `whiteboard` adjust fonts and themes on demand.
** Navigation/search
- `SPC /` and `SPC s` family rely on ripgrep (`deadgrep`, `consult-ag`) for project searches.

* Workflows
** Cleaning text copied from the web
1. Copy source content on macOS.
2. In the target Org buffer, hit `s-v`.
3. Verify headings, lists, and tables; Markdown tables keep their separators post-2025-09-24 fix.
** Switching visual modes for presentations
1. Call `large-type` for 350-height font.
2. Toggle theme via `whiteboard` or `matrix` as needed.
3. Restore preferred size with `medium-type`.
** Safe testing of config changes
1. From terminal run `./safe-emacs-test.sh` to launch Emacs without touching the main session.
2. Edit `.org` sources, then `C-c C-v t` to tangle and reload.

* Content Formats and Editing
** Transclude
Command-Shift-Down to add a transclude node!
** Literate programming
- Literate Org files contain `#+begin_src emacs-lisp` blocks; use `C-c C-v t` to tangle or enable `#+auto_tangle: t` headers.
- Keep documentation updates in `CHANGE-LOG.org` and `/docs` synchronized when making behavioral changes.

* Data Management Procedures
- Track changes with Git; commit with descriptive messages referencing affected modules and update the changelog before pushing.
- Back up local configuration by pushing to `origin/main` and (optionally) mirroring to Dropbox or Time Machine.
- Run `safe-emacs-test.sh` before major upgrades to ensure reproducibility.

* Troubleshooting
- **Packages missing** :: Run `SPC f e R` or delete `~/.emacs.d/elpa` to refresh; ensure `brew install ripgrep pandoc` for external dependencies.
- **Pasteboard commands fail** :: Confirm `pbpaste` is available (macOS only) and Terminal has permission to access the clipboard.
- **Slow startup** :: Recompile with `(byte-recompile-directory "~/emacs/emacs-settings" 0)` and prune unused layers in `init.el`.
